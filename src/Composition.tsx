import { useEffect, useRef, useState } from 'react';
import {
	AbsoluteFill,
	Audio,
	continueRender,
	delayRender,
	Easing,
	Img,
	interpolate,
	Sequence,
	staticFile,
//	useCurrentFrame,
	useVideoConfig,
} from 'remotion';
import audioSource from './assets/audio.mp3';
import coverImg from './assets/cover.jpg';
import { LINE_HEIGHT, PaginatedSubtitles } from './Subtitles';
import './style.css'

const subtitlesSource = staticFile('subtitles.srt');

export const AudiogramComposition = () => {
	const { durationInFrames } = useVideoConfig();

	const [handle] = useState(() => delayRender());
	const [subtitles, setSubtitles] = useState<string | null>(null);
	const ref = useRef<HTMLDivElement>(null);

	useEffect(() => {
		fetch(subtitlesSource)
			.then((res) => res.text())
			.then((text) => {
				setSubtitles(text);
				continueRender(handle);
			})
			.catch((err) => {
				console.log('Error fetching subtitles', err);
			});
	}, [handle]);

	// Change this to adjust the part of the audio to use
	const offset = 2000;

	if (!subtitles) {
		return null;
	}

	return (
		<div ref={ref}>
			<AbsoluteFill>
				<Sequence from={-offset}>
					<Audio src={audioSource} />

					<div
						className="container"
					>
						<div className="radial-gradient-1"/>
						<div className="radial-gradient-2"/>
							
						<div className="row">
							<Img className="cover" src={coverImg} />
							<div className="title-section">
								<div className="title">
									EPISODE NAME GOES HERE
								</div>
								<div className="subtitle">
									Name of the title would go here. It could be long.
								</div>
							</div>
						</div>

						<div
							style={{ 
								lineHeight: `${LINE_HEIGHT}px`,
							}}
							className="captions"
							
						>
							<PaginatedSubtitles
								src={subtitles}
								startFrame={offset}
								endFrame={offset + durationInFrames}
								linesPerPage={4}
								renderSubtitleItem={(item, frame) => (
									<>
										<span
											style={{
												backfaceVisibility: 'hidden',
												display: 'inline-block',
												
												opacity: interpolate(
													frame,
													[item.start, item.start + 15],
													[0, 1],
													{
														extrapolateLeft: 'clamp',
														extrapolateRight: 'clamp',
													}
												),
												transform: `perspective(1000px) translateY(${interpolate(
													frame,
													[item.start, item.start + 15],
													[0.5, 0],
													{
														easing: Easing.out(Easing.quad),
														extrapolateLeft: 'clamp',
														extrapolateRight: 'clamp',
													}
												)}em)`,
											}}
										>
											{item.text}
										</span>{' '}
									</>
								)}
							/>
						</div>
						<div className="tagline">
							<a style={{
									fontSize: '30px',
									fontWeight: '400',
									color: 'gray',
							}}>CREATED WITH &nbsp; &nbsp;</a>
							<svg width="50" height="49" viewBox="0 0 50 49" fill="none" xmlns="http://www.w3.org/2000/svg">
								<rect x="0.0341797" y="0.0234375" width="48.9683" height="48.9683" rx="5.29387" fill="#FFFFFF"/>
								<path d="M33.9 18.0517C33.664 17.9294 33.3997 17.8689 33.1329 17.8761C32.866 17.8832 32.6055 17.9577 32.3766 18.0924C32.1477 18.2271 31.9582 18.4175 31.8263 18.645C31.6945 18.8726 31.6247 19.1296 31.6239 19.3914V22.7276C31.6241 22.985 31.6911 23.2382 31.8185 23.4634C31.9459 23.6886 32.1296 23.8783 32.3522 24.0149V25.3789C32.3522 29.612 28.8391 33.0559 24.5205 33.0559C20.202 33.0559 16.6875 29.6098 16.6875 25.3768V24.0127C16.9102 23.8762 17.0939 23.6864 17.2213 23.4612C17.3487 23.2361 17.4156 22.9829 17.4159 22.7254V19.3914C17.4091 18.9929 17.2428 18.6129 16.9529 18.3335C16.663 18.0541 16.2727 17.8975 15.8662 17.8975C15.4596 17.8975 15.0693 18.0541 14.7794 18.3335C14.4895 18.6129 14.3232 18.9929 14.3164 19.3914V22.7276C14.317 23.0028 14.3938 23.2727 14.5384 23.5086C14.6831 23.7445 14.8903 23.9376 15.138 24.0672V25.3768C15.138 30.1483 19.0705 34.0818 23.8206 34.5294V39.0589H19.0932C18.8535 39.0589 18.6236 39.1523 18.4541 39.3184C18.2846 39.4846 18.1894 39.71 18.1894 39.945C18.1894 40.18 18.2846 40.4054 18.4541 40.5716C18.6236 40.7377 18.8535 40.8311 19.0932 40.8311H29.943C30.1827 40.8311 30.4127 40.7377 30.5822 40.5716C30.7517 40.4054 30.8469 40.18 30.8469 39.945C30.8469 39.71 30.7517 39.4846 30.5822 39.3184C30.4127 39.1523 30.1827 39.0589 29.943 39.0589H25.2156V34.5294C29.9658 34.0818 33.8983 30.1483 33.8983 25.3768V24.0672C34.1459 23.9375 34.353 23.7444 34.4977 23.5086C34.6424 23.2727 34.7191 23.0028 34.7199 22.7276V19.3914C34.7193 19.1163 34.6427 18.8466 34.4984 18.6107C34.3541 18.3748 34.1473 18.1817 33.9 18.0517Z" fill="#121212"/>
								<path d="M18.4345 21.3098V25.0919C18.4345 28.3693 21.1733 31.0563 24.5188 31.0563C27.8643 31.0563 30.6031 28.3715 30.6031 25.094V21.3137L18.4345 21.3098ZM25.9733 28.0466L24.5188 27.0104L23.0638 28.0483C23.0408 28.0648 23.013 28.0737 22.9845 28.0737C22.9559 28.0737 22.9281 28.0648 22.9051 28.0484C22.882 28.0319 22.8649 28.0087 22.8561 27.9821C22.8474 27.9555 22.8474 27.9269 22.8563 27.9003L23.4118 26.2238L21.9573 25.188C21.9341 25.1716 21.9168 25.1485 21.9079 25.1219C21.899 25.0953 21.8989 25.0666 21.9078 25.0399C21.9166 25.0133 21.9338 24.9901 21.9569 24.9737C21.9801 24.9573 22.0079 24.9485 22.0365 24.9486H23.8346L24.3905 23.2721C24.3993 23.2455 24.4165 23.2224 24.4395 23.2059C24.4625 23.1895 24.4903 23.1807 24.5188 23.1807C24.5473 23.1807 24.575 23.1895 24.5981 23.2059C24.6211 23.2224 24.6383 23.2455 24.647 23.2721L25.2025 24.9486H27.0007C27.0291 24.9487 27.0568 24.9575 27.0799 24.974C27.1029 24.9904 27.12 25.0135 27.1288 25.04C27.1377 25.0666 27.1377 25.0951 27.129 25.1217C27.1203 25.1483 27.1033 25.1715 27.0803 25.188L25.6253 26.2238L26.1813 27.9003C26.19 27.9269 26.1899 27.9555 26.181 27.982C26.1722 28.0086 26.155 28.0317 26.1319 28.0481C26.1089 28.0645 26.0812 28.0734 26.0527 28.0734C26.0242 28.0734 25.9964 28.0647 25.9733 28.0483V28.0466Z" fill="#121212"/>
								<path d="M19.1979 16.3765H18.4345V20.4834H19.1979V16.3765Z" fill="#121212"/>
								<path d="M20.3386 11.5664H19.5752V20.4834H20.3386V11.5664Z" fill="#121212"/>
								<path d="M21.4797 12.6889H20.7163V20.4834H21.4797V12.6889Z" fill="#121212"/>
								<path d="M22.6208 9.96286H21.8575V20.483H22.6208V9.96286Z" fill="#121212"/>
								<path d="M23.762 13.4432H22.9986V20.4834H23.762V13.4432Z" fill="#121212"/>
								<path d="M24.9031 12.3684H24.1397V20.483H24.9031V12.3684Z" fill="#121212"/>
								<path d="M26.0438 8.18555H25.2804V20.4834H26.0438V8.18555Z" fill="#121212"/>
								<path d="M27.1849 10.4259H26.4216V20.4834H27.1849V10.4259Z" fill="#121212"/>
								<path d="M28.3261 13.1699H27.5627V20.4834H28.3261V13.1699Z" fill="#121212"/>
								<path d="M29.4672 11.2733H28.7038V20.4834H29.4672V11.2733Z" fill="#121212"/>
								<path d="M30.6079 15.4145H29.8445V20.4834H30.6079V15.4145Z" fill="#121212"/>
								<path d="M33.9 18.0517C33.664 17.9294 33.3997 17.8689 33.1329 17.8761C32.866 17.8832 32.6055 17.9577 32.3766 18.0924C32.1477 18.2271 31.9582 18.4175 31.8263 18.645C31.6945 18.8726 31.6247 19.1296 31.6239 19.3914V22.7276C31.6241 22.985 31.6911 23.2382 31.8185 23.4634C31.9459 23.6886 32.1296 23.8783 32.3522 24.0149V25.3789C32.3522 29.612 28.8391 33.0559 24.5205 33.0559C20.202 33.0559 16.6875 29.6098 16.6875 25.3768V24.0127C16.9102 23.8762 17.0939 23.6864 17.2213 23.4612C17.3487 23.2361 17.4156 22.9829 17.4159 22.7254V19.3914C17.4091 18.9929 17.2428 18.6129 16.9529 18.3335C16.663 18.0541 16.2727 17.8975 15.8662 17.8975C15.4596 17.8975 15.0693 18.0541 14.7794 18.3335C14.4895 18.6129 14.3232 18.9929 14.3164 19.3914V22.7276C14.317 23.0028 14.3938 23.2727 14.5384 23.5086C14.6831 23.7445 14.8903 23.9376 15.138 24.0672V25.3768C15.138 30.1483 19.0705 34.0818 23.8206 34.5294V39.0589H19.0932C18.8535 39.0589 18.6236 39.1523 18.4541 39.3184C18.2846 39.4846 18.1894 39.71 18.1894 39.945C18.1894 40.18 18.2846 40.4054 18.4541 40.5716C18.6236 40.7377 18.8535 40.8311 19.0932 40.8311H29.943C30.1827 40.8311 30.4127 40.7377 30.5822 40.5716C30.7517 40.4054 30.8469 40.18 30.8469 39.945C30.8469 39.71 30.7517 39.4846 30.5822 39.3184C30.4127 39.1523 30.1827 39.0589 29.943 39.0589H25.2156V34.5294C29.9658 34.0818 33.8983 30.1483 33.8983 25.3768V24.0672C34.1459 23.9375 34.353 23.7444 34.4977 23.5086C34.6424 23.2727 34.7191 23.0028 34.7199 22.7276V19.3914C34.7193 19.1163 34.6427 18.8466 34.4984 18.6107C34.3541 18.3748 34.1473 18.1817 33.9 18.0517Z" fill="#121212"/>
								<path d="M18.4345 21.3098V25.0919C18.4345 28.3693 21.1733 31.0563 24.5188 31.0563C27.8643 31.0563 30.6031 28.3715 30.6031 25.094V21.3137L18.4345 21.3098ZM25.9733 28.0466L24.5188 27.0104L23.0638 28.0483C23.0408 28.0648 23.013 28.0737 22.9845 28.0737C22.9559 28.0737 22.9281 28.0648 22.9051 28.0484C22.882 28.0319 22.8649 28.0087 22.8561 27.9821C22.8474 27.9555 22.8474 27.9269 22.8563 27.9003L23.4118 26.2238L21.9573 25.188C21.9341 25.1716 21.9168 25.1485 21.9079 25.1219C21.899 25.0953 21.8989 25.0666 21.9078 25.0399C21.9166 25.0133 21.9338 24.9901 21.9569 24.9737C21.9801 24.9573 22.0079 24.9485 22.0365 24.9486H23.8346L24.3905 23.2721C24.3993 23.2455 24.4165 23.2224 24.4395 23.2059C24.4625 23.1895 24.4903 23.1807 24.5188 23.1807C24.5473 23.1807 24.575 23.1895 24.5981 23.2059C24.6211 23.2224 24.6383 23.2455 24.647 23.2721L25.2025 24.9486H27.0007C27.0291 24.9487 27.0568 24.9575 27.0799 24.974C27.1029 24.9904 27.12 25.0135 27.1288 25.04C27.1377 25.0666 27.1377 25.0951 27.129 25.1217C27.1203 25.1483 27.1033 25.1715 27.0803 25.188L25.6253 26.2238L26.1813 27.9003C26.19 27.9269 26.1899 27.9555 26.181 27.982C26.1722 28.0086 26.155 28.0317 26.1319 28.0481C26.1089 28.0645 26.0812 28.0734 26.0527 28.0734C26.0242 28.0734 25.9964 28.0647 25.9733 28.0483V28.0466Z" fill="#121212"/>
								<path d="M19.1979 16.3765H18.4345V20.4834H19.1979V16.3765Z" fill="#121212"/>
								<path d="M20.3386 11.5664H19.5752V20.4834H20.3386V11.5664Z" fill="#121212"/>
								<path d="M21.4797 12.6889H20.7163V20.4834H21.4797V12.6889Z" fill="#121212"/>
								<path d="M22.6208 9.96286H21.8575V20.483H22.6208V9.96286Z" fill="#121212"/>
								<path d="M23.762 13.4432H22.9986V20.4834H23.762V13.4432Z" fill="#121212"/>
								<path d="M24.9031 12.3684H24.1397V20.483H24.9031V12.3684Z" fill="#121212"/>
								<path d="M26.0438 8.18555H25.2804V20.4834H26.0438V8.18555Z" fill="#121212"/>
								<path d="M27.1849 10.4259H26.4216V20.4834H27.1849V10.4259Z" fill="#121212"/>
								<path d="M28.3261 13.1699H27.5627V20.4834H28.3261V13.1699Z" fill="#121212"/>
								<path d="M29.4672 11.2733H28.7038V20.4834H29.4672V11.2733Z" fill="#121212"/>
								<path d="M30.6079 15.4145H29.8445V20.4834H30.6079V15.4145Z" fill="#121212"/>
							</svg>
							<a style={{
								fontSize: '36px',
								fontWeight: '600',
								color: 'black'
							}}>&nbsp; &nbsp; Momento</a>
						</div>
					</div>
				</Sequence>
			</AbsoluteFill>
		</div>
	);
};
